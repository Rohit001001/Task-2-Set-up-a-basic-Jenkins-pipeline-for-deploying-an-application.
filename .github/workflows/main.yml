name: Frontend CI/CD Pipeline - Deploy to EC2

on:
  push:
    branches:
      - main  # Runs this workflow whenever you push to main branch

jobs:
  deploy:
    name: Build and Deploy Frontend to EC2
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Checkout your latest code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2ï¸âƒ£ (Optional) If your frontend uses npm (e.g. React, Angular, Vue)
      - name: Install and build frontend
        run: |
          if [ -f "package.json" ]; then
            echo "ğŸ“¦ Installing dependencies..."
            npm install
            echo "ğŸ—ï¸ Building frontend..."
            npm run build
          else
            echo "âš ï¸ No package.json found, skipping build."
          fi

      # 3ï¸âƒ£ Deploy built files or HTML/CSS/JS to EC2
      - name: ğŸš€ Deploy to EC2 via SSH
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USER }}
          key: ${{ secrets.EC2_KEY }}
          script: |
            echo "ğŸ” Connecting to EC2..."

            # Move into your project folder (change this path if different)
            cd ~/Task-2-Set-up-a-basic-Jenkins-pipeline-for-deploying-an-application

            echo "ğŸ“¥ Pulling latest code..."
            git pull origin main

            # If youâ€™re serving static files with Nginx or Apache:
            echo "ğŸ§¹ Removing old files..."
            sudo rm -rf /var/www/html/*

            echo "ğŸ“¦ Copying new build files..."
            if [ -d "build" ]; then
              sudo cp -r build/* /var/www/html/
            else
              sudo cp -r * /var/www/html/
            fi

            echo "ğŸ” Restarting NGINX..."
            sudo systemctl restart nginx

            echo "âœ… Frontend deployment completed!"
